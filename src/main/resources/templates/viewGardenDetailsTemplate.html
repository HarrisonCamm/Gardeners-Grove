<!DOCTYPE html>
<html lang="en">
    <!-- Head fragment holding all the style sheets-->
    <head th:replace="fragments/head :: head(title='View Garden')"> </head>
    <body>
        <ul th:insert="~{fragments/navBar.html :: navBar}"></ul>

        <div class="wrapper">
            <!-- Garden Side Navigation Bar Fragment -->
            <div th:insert="~{fragments/sideBar.html :: sideBar}"></div>

            <!-- View Garden Page Content -->
            <div class="gardenContainer">
                <div class="gardenDetails container">
                    <div class="row mb-3">
                        <div class="col">
                            <h3 th:text="${gardenName}">  </h3>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <h3 th:text="${gardenLocation}">  </h3>
                        </div>
                    </div>
                    <div class="row mb-3" th:classappend="${gardenSize == '' ? 'disabled' : ''}">
                        <div class="col">
                            <h3 th:utext="${gardenSize} + ' m<sup>2</sup>'"></h3>
                        </div>
                    </div>

                    <!-- Weather Section -->
                        <div class="row p-3">
                            <div class="col">
                                <div class="container bg-info bg-gradient shadow rounded-4 p-4 z-3 position-relative">
                                    <div th:if="${weatherResponse != null}">

                                        <h3><strong> <span th:text="${weatherResponse.dayOfWeek}"></span></strong></h3>
                                        <p><strong>Date:</strong> <span th:text="${weatherResponse.date}"></span></p>
                                        <p><strong>Description:</strong> <span th:text="${weatherResponse.description}"></span></p>
                                        <p><strong>Temperature:</strong> <span th:text="${weatherResponse.temperature}"></span>&#8451;</p>
                                        <p><strong>Humidity:</strong> <span th:text="${weatherResponse.humidity}"></span>%</p>

                                    <div class="z-2 position-absolute top-0 end-0">
                                        <img th:src="@{'http://openweathermap.org/img/wn/' + ${weatherResponse.icon} + '@2x.png'}" class="img-fluid w-200" alt="Weather Icon" />
                                    </div>
                                    </div>
                                    <div th:if="${weatherResponse == null}" class="error-message">
                                        <p>Location not found, please update your location to see the weather</p>
                                    </div>
                                </div>
                            </div>
                        </div>


                    <div class="row mb-3" th:if="${tags != null and tags.size() > 0}">
                        <div class="col d-flex flex-wrap">
                            <th:block th:each="tag : ${tags}">
                                <label class="me-2 mb-2" th:text="${tag}"></label>
                            </th:block>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col garden-details-button-row">
                            <div>
                                <a th:href="@{'/edit-garden?gardenID=' + ${gardenID}}" class="btn btn-primary button">
                                    Edit
                                </a>
                                <a th:href="@{'/create-plant?gardenID=' + ${gardenID}}" class="btn btn-primary ms-2 button">
                                    Add new plant
                                </a>
                            </div>
                            <form id="tagForm" th:action="@{/add-tag(gardenID=${gardenID})}" method="post">
                                <div class="tag-input">
                                    <div class="input-group ms-2 input-clear">
                                        <input type="text" class="form-control form-control-sm" placeholder="Enter tag" id="tagInput" name="tag">
                                        <button class="btn btn-secondary button" type="button" id="clearButton">x</button>
                                    </div>
                                    <button class="btn btn-primary button ms-2" type="submit" id="addTagButton">+</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div id="imageError" class="error-message"></div>
                        </div>
                    </div>
                </div>
                <div class="plantContainer table-responsive bg-light" style="max-height: calc(97px * 6); overflow-y: auto;">
                    <table class="table">
                        <thead>
                        <tr class="garden-table">
                            <th>Picture &nbsp;</th>
                            <th>Plant Name &nbsp;</th>
                            <th>Count &nbsp;</th>
                            <th>Description &nbsp;</th>
                            <th>Date Planted</th>
                            <th>Edit Plant</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="plant : ${plants}" class="plant-row">
                            <td>
                                <div class="image-icon-div-small">
                                    <div class="image-upload">
                                        <img class="image-small"
                                             th:id="${plant.id}" th:data-plant-id="${plant.id}"
                                             th:src="@{/get-image?view-garden=true(plantID=${plant.id})}" alt="">
                                        <input th:value="imagePath" class="file-input" type="file" name="file" id="file">
                                        <button class="image-picker-small" th:image-button-id="${plant.id}">+</button>
                                    </div>
                                </div>
                            </td>
                            <td th:text="${plant.name}"></td>
                            <td th:text="${plant.count}"></td>
                            <td th:text="${plant.description}"></td>
                            <td th:text="${plant.datePlanted}"></td>
                            <td>
                                <a th:href="@{'/edit-plant?plantID=' + ${plant.id}}">
                                    <button type="button" class="btn btn-primary button">Edit</button>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div th:replace="~{fragments/scripts :: scripts}"></div>
    </body>
</html>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        const plantContainer = document.querySelector('.plantContainer');
        const gardenDetails = document.querySelector('.gardenDetails');
        const clearButton = document.getElementById('clearButton');
        const tagInput = document.getElementById('tagInput');

        // Adjust width of gardenDetails initially
        adjustWidth();

        // Adjust width of gardenDetails when window is resized
        window.addEventListener('resize', adjustWidth);

        function adjustWidth() {
            const width = plantContainer.offsetWidth;
            gardenDetails.style.width = `${width}px`;
        }

        clearButton.addEventListener('click', () => {
            tagInput.value = '';
        });

        tagInput.addEventListener('keydown', (event) => {
            if (event.key === "Enter") {
                event.preventDefault();
                document.getElementById('tagForm').submit();
            }
        });
    });
</script>
