<!DOCTYPE html>
<html lang="en">
    <head th:replace="fragments/head :: head(title='View Garden')">
<!--        <meta charset="UTF-8">-->
<!--        <meta name="_csrf" th:content="${_csrf.token}"/>-->
<!--        <title>View Garden</title>-->
<!--        <link th:href="@{/css/generalStyles.css}" rel="stylesheet">-->
<!--        <link th:href="@{/css/navBar.css}" rel="stylesheet">-->
<!--        <script th:src="@{/javascript/image-handling.js}"></script>-->
    </head>
    <body>
        <ul th:insert="~{fragments/navBar.html :: navBar}"></ul>
        <div class="wrapper">
            <div class="d-flex flex-column flex-shrink-0 p-3 sideBarColour">
                <h3 class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-decoration-none text-white">Gardens</h3>
                <div class="list-group">
                    <th:block th:each="garden : ${gardens}">
                        <a class="list-group-item list-group-item-action" th:href="@{'/view-garden?gardenID=' + ${garden.id}}">
                            <span th:text="${#strings.abbreviate(garden.name,20)}"> Name </span>
                        </a>
                    </th:block>
                </div>
            </div>
            <div class="gardenContainer">
                <div class="gardenDetails container">
                    <div class="row mb-3">
                        <div class="col">
                            <h3 th:text="${gardenName}">  </h3>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <h3 th:text="${gardenLocation}">  </h3>
                        </div>
                    </div>
                    <div class="row mb-3" th:classappend="${gardenSize == '' ? 'disabled' : ''}">
                        <div class="col">
                            <h3 th:utext="${gardenSize} + ' m<sup>2</sup>'"></h3>
                        </div>
                    </div>
                    <div class="row mb-3" th:if="${gardenTags != null and gardenTags.size() > 0}">
                        <div class="col d-flex flex-wrap">
                            <th:block th:each="tag : ${gardenTags}">
                                <span class="badge me-2 mb-2 tag-colour" th:text="${#strings.abbreviate(tag.name,20)}"></span>
                            </th:block>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col garden-details-button-row">
                            <div>
                                <a th:href="@{'/edit-garden?gardenID=' + ${gardenID}}" class="btn btn-primary button">
                                    Edit
                                </a>
                                <a th:href="@{'/create-plant?gardenID=' + ${gardenID}}" class="btn btn-primary ms-2 button">
                                    Add new plant
                                </a>
                            </div>
                            <form id="tagForm" th:action="@{/add-tag(gardenID=${gardenID})}" method="post">
                                <div class="tag-input">
                                    <div class="input-group ms-2 input-clear">
                                        <input type="text" class="form-control form-control-sm" placeholder="Enter tag" id="tagInput" name="tag">
                                        <button class="btn btn-secondary button" type="button" id="clearButton">x</button>
                                    </div>
                                    <button class="btn btn-primary button ms-2" type="submit" id="addTagButton">+</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div id="imageError" class="error-message"></div>
                        </div>
                    </div>
                </div>
                <div class="plantContainer table-responsive bg-light" style="max-height: calc(97px * 6); overflow-y: auto;">
                    <table class="table">
                        <thead>
                        <tr class="garden-table">
                            <th>Picture &nbsp;</th>
                            <th>Plant Name &nbsp;</th>
                            <th>Count &nbsp;</th>
                            <th>Description &nbsp;</th>
                            <th>Date Planted</th>
                            <th>Edit Plant</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="plant : ${plants}" class="plant-row">
                            <td>
                                <div class="image-icon-div-small">
                                    <div class="image-upload">
                                        <img class="image-small"
                                             th:id="${plant.id}" th:data-plant-id="${plant.id}"
                                             th:src="@{/get-image?view-garden=true(plantID=${plant.id})}" alt="">
                                        <input th:value="imagePath" class="file-input" type="file" name="file" id="file">
                                        <button class="image-picker-small" th:image-button-id="${plant.id}">+</button>
                                    </div>
                                </div>
                            </td>
                            <td th:text="${plant.name}"></td>
                            <td th:text="${plant.count}"></td>
                            <td th:text="${plant.description}"></td>
                            <td th:text="${plant.datePlanted}"></td>
                            <td>
                                <a th:href="@{'/edit-plant?plantID=' + ${plant.id}}">
                                    <button type="button" class="btn btn-primary button">Edit</button>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div th:replace="~{fragments/scripts :: scripts}"></div>
    </body>
</html>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        const plantContainer = document.querySelector('.plantContainer');
        const gardenDetails = document.querySelector('.gardenDetails');
        const clearButton = document.getElementById('clearButton');
        const tagInput = document.getElementById('tagInput');

        // Adjust width of gardenDetails initially
        adjustWidth();

        // Adjust width of gardenDetails when window is resized
        window.addEventListener('resize', adjustWidth);

        function adjustWidth() {
            const width = plantContainer.offsetWidth;
            gardenDetails.style.width = `${width}px`;
        }

        clearButton.addEventListener('click', () => {
            tagInput.value = '';
        });

        tagInput.addEventListener('keydown', (event) => {
            if (event.key === "Enter") {
                event.preventDefault();
                document.getElementById('tagForm').submit();
            }
        });
    });
</script>
