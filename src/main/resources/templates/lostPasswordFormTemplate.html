<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" context="text/html; charset=UTF-8">
    <title>Lost Password</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            padding-top: 5%;
        }
        .error, .form-control {
            width: 300px;
            font-size: 100%;
        }
        .error {
            border-radius: 2px;
            border: 1px solid red;
            outline: 1px solid red;
        }
        .error:focus {
            outline: 2px solid red;
        }
        .error-message {
            color: red;
            display: block;
            width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        button, label {
            font-size: 120%;
        }
        .buttons {
            display: flex;
            justify-content: flex-end;
        }
        h2 {
            text-align: center;
        }
        .link {
            font-size: 120%;
        }
        @media only screen and (orientation: portrait) {
            h2 {
                font-size: 300%;
            }
            button {
                font-size: 200%;
            }
            label {
                font-size: 200%;
            }
            .form-control {
                font-size: 180%;
                width: 540px;
                border: 2px solid;
                border-radius: 2px;
            }
            .form-control[disabled] {
                border-color: #ccc;
            }
            .error {
                font-size: 180%;
                width: 540px;
                border: 2px solid red;
                border-radius: 2px;
                outline: 2px solid red;
            }
            .error:focus {
                outline: 4px solid red;
            }
            .error-message {
                width: 540px;
                font-size: 150%;
            }
            .link {
                font-size: 200%;
            }
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelector('form').addEventListener('keydown', function(event) {
                let submitButton = document.getElementById("submitButton");
                let cancelButton = document.getElementById("cancelButton");
                if (event.key === 'Enter' && document.activeElement !== submitButton) {
                    if(document.activeElement === cancelButton) {
                        cancelButton.click();
                    }
                    event.preventDefault();
                    return false;
                }
            });
        });
    </script>
</head>
<body>
<div>
    <h2>Give email</h2>
    <div>
        <!-- the 'novalidate' disables the default HTML5 validation -->
        <form id="lostPasswordForm" th:action="@{/lost-password-form}" method="post" novalidate>
<!--            // todo make get?-->
            <label for="email"> Email: </label>
            <br/>

            <input type="text" class="form-control" id="email"
                   th:name="email" th:value="${email}" data-cy="email" required autofocus
                   th:class="${lostPasswordEmailError != null ? 'error' : 'form-control'}">
            <br/>

            <!-- Display error message if there is an error with the email existing-->
            <div th:if="${lostPasswordEmailError}" class="error-message" th:text="${lostPasswordEmailError}"></div>
            <br/>

            <div class="buttons">
                <button type="submit" onclick="validateEmail()" id="submitButton">Send Email</button>
                &nbsp;
                <a th:href="@{/home}" id="cancelButton">
                    <button type="button">Cancel</button>
                </a>
            </div>
        </form>
    </div>
</div>
<script>
    function validateEmail() {
        let emailInput = document.getElementById("email");
        let emailValue = emailInput.value;
        let emailError = document.getElementById("resetPasswordEmailError");

        // Store the email in the local storage
        localStorage.setItem('email', emailValue);

        // Regex to check for a basic email pattern
        let emailRegex = /^[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}$/;

        if ((!emailRegex.test(emailValue) && emailValue) || !emailValue) {
            emailError.innerText = "Email address must be in the form 'jane@doe.nz'";
            emailInput.classList.add("error");
            event.preventDefault();
        } else {
            emailError.innerText = "";
            emailInput.classList.remove("error");
        }
    }
</script>
</body>
</html>