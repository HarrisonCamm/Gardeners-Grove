<!DOCTYPE html>
<html lang="en">
<head th:replace="fragments/head :: head(title='Messages')"> </head>
<body>
  <ul th:insert="~{fragments/navBar.html :: navBar}"></ul>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1>Conversations</h1>
        <div th:each="friend : ${friends}">
          <div class="d-flex flex-row">
            <img class="image-small"
                 th:data-user-id="${friend.userId}"
                 th:src="@{/get-image?view-user-profile=true(userID=${friend.userId})}" alt="">
            <p class="center-text friend-name" th:text="${friend.firstName + ' ' + friend.lastName}"></p>
            <hr>
          </div>
        </div>
      </div>
    </div>

    <script th:src="@{/webjars/stomp-websocket/2.3.4/stomp.min.js}"></script>
<!--    AI GENERATED-->
    <script type="text/javascript">
      let stompClient = null;

      function connect() {
        const socket = new WebSocket('/ws');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
          console.log('Connected: ' + frame);

          stompClient.subscribe('/user/queue/reply', function (messageOutput) {
            showMessage(JSON.parse(messageOutput.body));
          });
        });
      }

      function sendMessage() {
        const messageContent = document.getElementById('message-input').value.trim();
        if(messageContent && stompClient) {
          const chatMessage = {
            sender: "startup@user.com",  // Replace with actual sender
            content: messageContent,
          };
          stompClient.send("/app/chat.send/" + "sarah@email.com", {}, JSON.stringify(chatMessage));
          document.getElementById('message-input').value = '';
        }
      }

      function showMessage(message) {
        var messageElement = document.createElement('div');
        messageElement.innerHTML = `<strong>${message.sender}:</strong> ${message.content}`;
        document.getElementById('messages').appendChild(messageElement);
      }

      document.getElementById('send-button').addEventListener('click', sendMessage);
      connect();
    </script>
  <div th:replace="~{fragments/scripts :: scripts}"></div>
</body>
</html>