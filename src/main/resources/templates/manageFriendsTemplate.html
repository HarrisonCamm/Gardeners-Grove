<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Manage Friends</title>
    <!-- Navbar styling -->
    <link th:href="@{/css/navBar.css}" rel="stylesheet"/>
    <link th:href="@{/css/homeMainStyles.css}" rel="stylesheet"/>
    <link th:href="@{/css/generalStyles.css}" rel="stylesheet"/>
    <script th:src="@{javascript/prevent-enter-submit.js}"></script>
    <script th:src="@{/javascript/hover-enter.js}"></script>
</head>
<body>
<ul th:insert="~{fragments/navBar.html :: navBar}"></ul>
<div>
    <div class="manage-friends-page">
        <div>
            <div class="friends-container">
                <div th:if="${#lists.isEmpty(friends)}">
                    <h3>Your friends will be shown here</h3>
                </div>
                <div th:if="${!#lists.isEmpty(friends)}">
                    <h3>Your Friends</h3>
                    <div>
                    <ul>
                        <li th:each="friend : ${friends}">
                            <div class="background">
                                <div class="align-left">
                                    <img class="image-small" th:src="@{/get-image?view-user-profile=true(userID=${friend.userId})}" alt="">
                                    &nbsp;
                                    <h3 th:text="${friend.firstName + ' ' + friend.lastName}"></h3>
                                </div>
                                <div id="removeFriend" th:hidden="false">
                                    <div class="buttons-right">
                                        <button onclick="toggleRemoveFriend()">Remove Friend</button>
                                    </div>
                                </div>
                                <form th:action="@{/manage-friends}" method="post" novalidate>
                                    <div id="confirmRemoveFriend" th:hidden="true">
                                        <div class="buttons-right">
                                            <button type="submit" onclick="document.getElementById('friend-remove-action').value='remove'">Confirm</button>
                                            <input type="hidden" th:name="email" th:value="${friend.email}" />
                                            <input type="hidden" th:name="action" id="friend-remove-action" />
                                            <button onclick="toggleRemoveFriend()">Cancel</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </li>
                    </ul>
                </div>
                </div>
            </div>
        </div>
        <script>
            function toggleRemoveFriend(){
                let removeFriendButton = document.getElementById("removeFriend");
                let confirmRemoveFriendButton = document.getElementById("confirmRemoveFriend");

                removeFriendButton.hidden = !(removeFriendButton.hidden)
                confirmRemoveFriendButton.hidden = !(confirmRemoveFriendButton.hidden)
            }
        </script>
        <div>
            <div>
                <div class="buttons-centre">
                    <button onclick="toggleForm()">Add Friend</button>
                </div>
            </div>
            <div class="search-container">
                <form th:action="@{/manage-friends}" method="post" novalidate th:hidden="${showSearch}">
                    <div class="search-div">
                        <label for="search"></label>
                        <input th:name="searchQuery"
                               th:value="${searchQuery}"
                               class="search-field"
                               id="search"
                               type="text"
                               placeholder="Search for a friend">
                        &nbsp;&nbsp;&nbsp;
                        <div class="search-button">
                            <button type="submit" onclick="searchAndShowResults()">Search</button>
                        </div>
                    </div>
                    <input type="hidden" name="action" id="action" />
                    <div class="search-friend" id="searchFriend">
                        <br/>
                        <p th:if="${searchResultMessage}" class="search-field-message" th:text="${searchResultMessage}"></p>
                        <div>
                            <div th:if="${matchedUsers}" class="results-container" id="results-container">
                                <ul>
                                    <li th:each="matchedUser : ${matchedUsers}">
                                        <div>
                                            <h3 th:text="${matchedUser.firstName + ' - ' + matchedUser.email}"></h3>
                                            <input type="hidden" name="email" th:value="${matchedUser.email}" />
                                            <button type="submit" onclick="document.getElementById('action').value='invite'">Invite as Friend</button>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="requests-container">

                <h3>Friend Requests</h3>
                <div class="friend-container-scroll" th:if="${pendingRequests}">
                    <ul>
                        <li th:each="pendingRequest : ${pendingRequests}">
                            <form th:action="@{/manage-friends}" method="post" novalidate>
                                <div>
                                    <div class="friend-form">
                                        <div class="align-left">
                                            <h3 th:text="${pendingRequest.sender.firstName}"></h3>
                                            <input type="hidden" th:name="action" id="friend-request-action" />
                                            <input type="hidden" th:name="email" th:value="${pendingRequest.sender.email}" />
                                        </div>
                                        <div class="empty-space"></div>
                                        <div class="buttons-right">
                                            <button type="submit" onclick="document.getElementById('friend-request-action').value='delete'">
                                                Delete
                                            </button>
                                            <button type="submit" onclick="document.getElementById('friend-request-action').value='accept'">
                                                Accept
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="requests-container">
                <h3>Sent Requests</h3>
                <div class="friend-container-scroll" th:if="${sentRequests}">
                    <ul>
                        <li th:each="sentRequest : ${sentRequests}">
                            <form th:action="@{/manage-friends}" method="post" novalidate>
                                <div>
                                    <div class="friend-form">
                                        <div class="align-left">
                                            <h3 th:text="${sentRequest.receiver.firstName + ' - ' + sentRequest.receiver.email}"></h3>
                                            <input type="hidden" th:name="email" th:value="${sentRequest.receiver.email}" />
                                        </div>
                                        <div class="empty-space"></div>
                                        <div class="buttons-right">
                                            <h3 th:text="${sentRequest.status}"></h3>
                                            <input type="hidden" th:name="action" th:value="cancel" />
                                            &nbsp;
                                            <button type="submit">
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

    </div>
</div>
<script>
    function toggleForm() {
        const form = document.querySelector('.search-container form');
        form.hidden = !form.hidden;
    }

    function searchAndShowResults() {
        document.getElementById('action').value='search';
        const form = document.querySelector('.search-container form');
        form.submit();
        const searchFriend = document.getElementById("searchFriend");
        searchFriend.hidden = false;
    }
</script>
</body>
</html>